# Mysql索引

> [2-3-4树](https://asea-cch.life/achrives/2-3-4-tree)

> [B树](https://asea-cch.life/achrives/btree)

> [B+树](https://asea-cch.life/achrives/b+tree)

铺垫了很多关于树结构、基本外存读写机制和Mysql的存储结构，本文将开始分析Mysql的索引机制

    思考1：如果没有索引的话，我们应如何查找数据？

在没有索引的情况下，最基本的查询算法是**顺序查找**，但O(N)的时间复杂度以及随机性极强的特性，在数据大量级情况下性能及其糟糕

    思考2：顺序查找不行，那让数据的插入按照某种顺序，再用N分查找不行么？

N分查找在一定程度上提升了查找效率，并且降低查询次数的随机性，将最大查找次数控制在了$O(log_N^N)$上。但是按照某种顺序插入这个是痛点，这会造成巨大的数据移动成本，甚至还需要I/O读块到内存，会使得这个移动成本变得更大

    思考3：那既然通过连续空间这种组织数据的方式有移动成本，我使用B-树不就行了

这里就不再强调为什么不用红黑树这个问题了，详情可以查看下面文章的第三章，有讲解到B-树为何更适合作为外部存储的数据结构

> [2-3-4树](https://asea-cch.life/achrives/2-3-4-tree)

使用B/B+/B*树来组织数据，确实可以干掉以上问题的很多痛点，但是又有新的问题出现了：

    树结构的建立是依据数据的某个组织，它的查找优势只能基于该组织，往往我们需要的查找，不应只有该组织，可能是通过其他组织，甚至多个组织组合

所以，数据库维护着满足**基于特定的查找算法**的数据结构，这些数据结构以某种方式引用数据，我们可以通过在这些数据结构上**实现高级查找算法找到数据引用**，再间接地通过引用锁定到真实数据上，这些数据结构就叫做索引

通过索引，我们可以忽视掉底层数据的组织形式，尽管它们可能是以B-树组织的，或者按照插入顺序排列的连续空间

> [Mysql存储格式](https://asea-cch.life/achrives/mysql存储格式)

# **1. 索引的分类**

当然，数据库系统的索引可能不只是前言所说的高级查找算法，它涉及到的层面很多，本节我们将从不同层面上对索引进行梳理，这些索引术语可能来自数 据存储（应用层）、算法和用户层等各方各面：

先罗列一下这些讨人厌的索引：

    聚簇索引、非聚簇索引、B+树索引、哈希索引、R树索引、全文索引、空间数据索引、唯一索引、普通索引、主键索引、前缀索引、覆盖索引

尽管它们好像都有自己的名词，但是有的索引是同个意思，还是先按大致分类，如下：

- 数据存储
    - 聚簇索引
    - 非聚簇索引
- 算法
    - B+树索引
    - 哈希索引
    - R树索引
- 用户层
    - 主键索引
    - 唯一索引
    - 普通索引
        - 普通多列索引
    - 全文索引
    - 空间索引

## **1.1 数据存储**

在前言里，我们提到了索引可以忽视掉底层的数据结构，但是

- Mysql的innodb存储引擎，它的索引和数据没有分开，而是将两者放在了一块，**索引结构的叶子节点保存了行数据**

- Mysqlk的myisam存储引擎，则是将**数据与索引分开存储**，索引结构的叶子节点指向了数据对应的位置

通过以上的例子，我们来探讨一下聚簇索引与非聚簇索引的区别

### **1.1.1 聚簇索引**

innodb对数据的组织方式，我们称为聚簇索引



# question:

问：myisam和innodb都是用的B+树存数据，为什么myisam可以没有主键

答：其实innodb也可以没有主键，是一般建议有主键，因为聚簇索引存的是所有列数据，一般是查到主键ID，通过聚簇索引回表查到所有数据；
myisam的叶子节点存的是地址好像，树结构存的东西不一样

问：是不是聚簇索引不仅是包含主键索引的那一个B+树，还包含了其他的二级索引对应的B+树

答：不是，聚簇存的是所有行数据 ，普通索引存的是主键索引的值

# 参考
- [Cyc2018：Mysql](https://www.cyc2018.xyz/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#%E4%B8%80%E3%80%81%E7%B4%A2%E5%BC%95)

# 重点参考
- [MySQL索引背后的数据结构及算法原理](http://blog.codinglabs.org/articles/theory-of-mysql-index.html)
- [浅谈聚簇索引和非聚簇索引的区别](https://my.oschina.net/xiaoyoung/blog/3046779)
